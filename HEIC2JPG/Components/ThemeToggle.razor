@inject IJSRuntime JS
@inject ILocalizationService Localizer

<button class="theme-toggle"
        @onclick="ToggleTheme"
        title="@GetThemeTooltip()"
        aria-label="@GetThemeTooltip()">
    <span class="theme-icon">@GetThemeIcon()</span>
</button>

@code {
    private string currentTheme = "light";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await UpdateCurrentTheme();
        }
    }

    private async Task ToggleTheme()
    {
        try
        {
            var newTheme = await JS.InvokeAsync<string>("themeManager.toggleTheme");
            currentTheme = newTheme;
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"„ÉÜ„Éº„ÉûÂàá„ÇäÊõø„Åà„Ç®„É©„Éº: {ex.Message}");
        }
    }

    private async Task UpdateCurrentTheme()
    {
        try
        {
            currentTheme = await JS.InvokeAsync<string>("themeManager.getConfiguredTheme");
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"„ÉÜ„Éº„ÉûÂèñÂæó„Ç®„É©„Éº: {ex.Message}");
        }
    }

    private string GetThemeIcon()
    {
        return currentTheme switch
        {
            "dark" => "‚òÄÔ∏è",  // „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÊôÇ„ÅØÂ§™ÈôΩÔºà„É©„Ç§„Éà„Å´Âàá„ÇäÊõø„Åà„ÇãÔºâ
            "light" => "üåô", // „É©„Ç§„Éà„É¢„Éº„ÉâÊôÇ„ÅØÊúàÔºà„ÉÄ„Éº„ÇØ„Å´Âàá„ÇäÊõø„Åà„ÇãÔºâ
            "auto" => "üîÑ",  // Ëá™Âãï„É¢„Éº„ÉâÊôÇ„ÅØ„É™„Çµ„Ç§„ÇØ„É´„Ç¢„Ç§„Ç≥„É≥Ôºà„É©„Ç§„Éà„Å´Âàá„ÇäÊõø„Åà„ÇãÔºâ
            _ => "üåô"
        };
    }

    private string GetThemeTooltip()
    {
        return currentTheme switch
        {
            "dark" => Localizer.GetString("Theme.SwitchToAuto"),
            "light" => Localizer.GetString("Theme.SwitchToDark"),
            "auto" => Localizer.GetString("Theme.SwitchToLight"),
            _ => Localizer.GetString("Theme.Toggle")
        };
    }
}
